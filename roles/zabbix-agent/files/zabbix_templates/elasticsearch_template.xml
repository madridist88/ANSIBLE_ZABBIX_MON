<?xml version="1.0" encoding="UTF-8"?>
<zabbix_export>
    <version>4.4</version>
    <date>2020-03-05T05:08:17Z</date>
    <groups>
        <group>
            <name>Templates</name>
        </group>
    </groups>
    <templates>
        <template>
            <template>Template elasticsearch</template>
            <name>Template elasticsearch</name>
            <description>Шаблон для мониторинга Elasticsearch</description>
            <groups>
                <group>
                    <name>Templates</name>
                </group>
            </groups>
            <applications>
                <application>
                    <name>elasticsearch</name>
                </application>
            </applications>
            <items>
                <item>
                    <name>Systemd unit elasticsearch остановлен</name>
                    <key>docker.service.status[{$ELASTICSEARCH.SYSTEMD.UNIT}]</key>
                    <applications>
                        <application>
                            <name>elasticsearch</name>
                        </application>
                    </applications>
                    <triggers>
                        <trigger>
                            <expression>{last()}=0</expression>
                            <name>Systemd unit elasticsearch is not active</name>
                            <priority>AVERAGE</priority>
                            <manual_close>YES</manual_close>
                        </trigger>
                    </triggers>
                </item>
                <item>
                    <name>Получение cluster health</name>
                    <key>elastic.cluster.health</key>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <applications>
                        <application>
                            <name>elasticsearch</name>
                        </application>
                    </applications>
                </item>
                <item>
                    <name>Использование файловых дескрипторов, в % от максимума</name>
                    <type>CALCULATED</type>
                    <key>elastic.file.descriptors.utilization</key>
                    <value_type>FLOAT</value_type>
                    <params>elastic.nodes.open_file_descriptors*100/elastic.nodes.max_file_descriptors</params>
                    <applications>
                        <application>
                            <name>elasticsearch</name>
                        </application>
                    </applications>
                    <triggers>
                        <trigger>
                            <expression>{last()}&gt;90</expression>
                            <name>Количество открытых файловых дескрипторов elasticsearch {ITEM.LASTVALUE}</name>
                            <priority>AVERAGE</priority>
                            <manual_close>YES</manual_close>
                        </trigger>
                    </triggers>
                </item>
                <item>
                    <name>Объем jvm max heap</name>
                    <type>DEPENDENT</type>
                    <key>elastic.nodes.heap_max_in_bytes</key>
                    <delay>0</delay>
                    <units>bytes</units>
                    <applications>
                        <application>
                            <name>elasticsearch</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <params>$.nodes.*.jvm.mem.heap_max_in_bytes</params>
                        </step>
                        <step>
                            <type>TRIM</type>
                            <params>[]</params>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>elastic.nodes.stats</key>
                    </master_item>
                </item>
                <item>
                    <name>Объем использованной jvm heap</name>
                    <type>DEPENDENT</type>
                    <key>elastic.nodes.heap_used_in_bytes</key>
                    <delay>0</delay>
                    <units>bytes</units>
                    <applications>
                        <application>
                            <name>elasticsearch</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <params>$.nodes.*.jvm.mem.heap_used_in_bytes</params>
                        </step>
                        <step>
                            <type>TRIM</type>
                            <params>[]</params>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>elastic.nodes.stats</key>
                    </master_item>
                </item>
                <item>
                    <name>Утилизация jvm heap, %</name>
                    <type>DEPENDENT</type>
                    <key>elastic.nodes.heap_used_percent</key>
                    <delay>0</delay>
                    <units>%</units>
                    <applications>
                        <application>
                            <name>elasticsearch</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <params>$.nodes.*.jvm.mem.heap_used_percent</params>
                        </step>
                        <step>
                            <type>TRIM</type>
                            <params>[]</params>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>elastic.nodes.stats</key>
                    </master_item>
                </item>
                <item>
                    <name>Node количество документов</name>
                    <type>DEPENDENT</type>
                    <key>elastic.nodes.indices.docs.count</key>
                    <delay>0</delay>
                    <applications>
                        <application>
                            <name>elasticsearch</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <params>$.nodes.*.indices.docs.count</params>
                        </step>
                        <step>
                            <type>TRIM</type>
                            <params>[]</params>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>elastic.nodes.stats</key>
                    </master_item>
                </item>
                <item>
                    <name>Максимальное количество файловых дескрипторов</name>
                    <type>DEPENDENT</type>
                    <key>elastic.nodes.max_file_descriptors</key>
                    <delay>0</delay>
                    <applications>
                        <application>
                            <name>elasticsearch</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <params>$.nodes.*.process.max_file_descriptors</params>
                        </step>
                        <step>
                            <type>TRIM</type>
                            <params>[]</params>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>elastic.nodes.stats</key>
                    </master_item>
                </item>
                <item>
                    <name>Количество открытых файловых дескрипторов</name>
                    <type>DEPENDENT</type>
                    <key>elastic.nodes.open_file_descriptors</key>
                    <delay>0</delay>
                    <applications>
                        <application>
                            <name>elasticsearch</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <params>$.nodes.*.process.open_file_descriptors</params>
                        </step>
                        <step>
                            <type>TRIM</type>
                            <params>[]</params>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>elastic.nodes.stats</key>
                    </master_item>
                </item>
                <item>
                    <name>Node объем данных</name>
                    <type>DEPENDENT</type>
                    <key>elastic.nodes.sotre.bytes</key>
                    <delay>0</delay>
                    <units>bytes</units>
                    <applications>
                        <application>
                            <name>elasticsearch</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <params>$.nodes.*.indices.store.size_in_bytes</params>
                        </step>
                        <step>
                            <type>TRIM</type>
                            <params>[]</params>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>elastic.nodes.stats</key>
                    </master_item>
                </item>
                <item>
                    <name>Получение node stats</name>
                    <key>elastic.nodes.stats</key>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <applications>
                        <application>
                            <name>elasticsearch</name>
                        </application>
                    </applications>
                </item>
                <item>
                    <name>Количество jvm threads</name>
                    <type>DEPENDENT</type>
                    <key>elastic.nodes.threads.count</key>
                    <delay>0</delay>
                    <applications>
                        <application>
                            <name>elasticsearch</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <params>$.nodes.*.jvm.threads.count</params>
                        </step>
                        <step>
                            <type>TRIM</type>
                            <params>[]</params>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>elastic.nodes.stats</key>
                    </master_item>
                </item>
                <item>
                    <name>Количество активных primary shards</name>
                    <type>DEPENDENT</type>
                    <key>elasticsearch.active_primary_shards</key>
                    <delay>0</delay>
                    <applications>
                        <application>
                            <name>elasticsearch</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <params>$.active_primary_shards</params>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>elastic.cluster.health</key>
                    </master_item>
                </item>
                <item>
                    <name>Количество активных shards</name>
                    <type>DEPENDENT</type>
                    <key>elasticsearch.active_shards</key>
                    <delay>0</delay>
                    <applications>
                        <application>
                            <name>elasticsearch</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <params>$.active_shards</params>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>elastic.cluster.health</key>
                    </master_item>
                </item>
                <item>
                    <name>Количество active shards percent as number</name>
                    <type>DEPENDENT</type>
                    <key>elasticsearch.active_shards_percent_as_number</key>
                    <delay>0</delay>
                    <applications>
                        <application>
                            <name>elasticsearch</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <params>$.active_shards_percent_as_number</params>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>elastic.cluster.health</key>
                    </master_item>
                </item>
                <item>
                    <name>Количество delayed unassigned shards</name>
                    <type>DEPENDENT</type>
                    <key>elasticsearch.delayed_unassigned_shards</key>
                    <delay>0</delay>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <applications>
                        <application>
                            <name>elasticsearch</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <params>$.delayed_unassigned_shards</params>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>elastic.cluster.health</key>
                    </master_item>
                </item>
                <item>
                    <name>Количество initializing shards</name>
                    <type>DEPENDENT</type>
                    <key>elasticsearch.initializing_shards</key>
                    <delay>0</delay>
                    <applications>
                        <application>
                            <name>elasticsearch</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <params>$.initializing_shards</params>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>elastic.cluster.health</key>
                    </master_item>
                </item>
                <item>
                    <name>Количество дата нод</name>
                    <type>DEPENDENT</type>
                    <key>elasticsearch.number_of_data_nodes</key>
                    <delay>0</delay>
                    <applications>
                        <application>
                            <name>elasticsearch</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <params>$.number_of_data_nodes</params>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>elastic.cluster.health</key>
                    </master_item>
                </item>
                <item>
                    <name>Количество in flight fetch</name>
                    <type>DEPENDENT</type>
                    <key>elasticsearch.number_of_in_flight_fetch</key>
                    <delay>0</delay>
                    <applications>
                        <application>
                            <name>elasticsearch</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <params>$.number_of_in_flight_fetch</params>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>elastic.cluster.health</key>
                    </master_item>
                </item>
                <item>
                    <name>Количество нод</name>
                    <type>DEPENDENT</type>
                    <key>elasticsearch.number_of_nodes</key>
                    <delay>0</delay>
                    <applications>
                        <application>
                            <name>elasticsearch</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <params>$.number_of_nodes</params>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>elastic.cluster.health</key>
                    </master_item>
                </item>
                <item>
                    <name>Количество pending tasks</name>
                    <type>DEPENDENT</type>
                    <key>elasticsearch.number_of_pending_tasks</key>
                    <delay>0</delay>
                    <applications>
                        <application>
                            <name>elasticsearch</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <params>$.number_of_pending_tasks</params>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>elastic.cluster.health</key>
                    </master_item>
                </item>
                <item>
                    <name>Количество relocating shards</name>
                    <type>DEPENDENT</type>
                    <key>elasticsearch.relocating_shards</key>
                    <delay>0</delay>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <applications>
                        <application>
                            <name>elasticsearch</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <params>$.relocating_shards</params>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>elastic.cluster.health</key>
                    </master_item>
                </item>
                <item>
                    <name>Статус кластера</name>
                    <type>DEPENDENT</type>
                    <key>elasticsearch.status</key>
                    <delay>0</delay>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <applications>
                        <application>
                            <name>elasticsearch</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <params>$.status</params>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>elastic.cluster.health</key>
                    </master_item>
                    <triggers>
                        <trigger>
                            <expression>{str(red)}=1</expression>
                            <name>Статус кластера Elasticsearch red</name>
                            <priority>HIGH</priority>
                            <manual_close>YES</manual_close>
                        </trigger>
                        <trigger>
                            <expression>{str(yellow)}=1</expression>
                            <name>Статус кластера Elasticsearch yellow</name>
                            <priority>AVERAGE</priority>
                            <manual_close>YES</manual_close>
                        </trigger>
                    </triggers>
                </item>
                <item>
                    <name>Количество task_max_waiting_in_queue_millis</name>
                    <type>DEPENDENT</type>
                    <key>elasticsearch.task_max_waiting_in_queue_millis</key>
                    <delay>0</delay>
                    <applications>
                        <application>
                            <name>elasticsearch</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <params>$.task_max_waiting_in_queue_millis</params>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>elastic.cluster.health</key>
                    </master_item>
                </item>
                <item>
                    <name>Количество unassigned shards</name>
                    <type>DEPENDENT</type>
                    <key>elasticsearch.unassigned_shards</key>
                    <delay>0</delay>
                    <applications>
                        <application>
                            <name>elasticsearch</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <params>$.unassigned_shards</params>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>elastic.cluster.health</key>
                    </master_item>
                    <triggers>
                        <trigger>
                            <expression>{last()}&gt;0</expression>
                            <name>Количество unassigned shards {ITEM.LASTVALUE}</name>
                            <priority>AVERAGE</priority>
                            <manual_close>YES</manual_close>
                        </trigger>
                    </triggers>
                </item>
                <item>
                    <name>Количество процессов elasticsearch</name>
                    <key>proc.num[,,,elasticsearch]</key>
                    <applications>
                        <application>
                            <name>elasticsearch</name>
                        </application>
                    </applications>
                    <triggers>
                        <trigger>
                            <expression>{last()}=0</expression>
                            <name>Процесс elasticsearch</name>
                            <priority>AVERAGE</priority>
                            <manual_close>YES</manual_close>
                        </trigger>
                    </triggers>
                </item>
            </items>
        </template>
    </templates>
</zabbix_export>

